---
import { Image } from 'astro:assets';
import big from '@assets/big__engine.svg';
import VideoDesktop from '@components/VideoDesktop.astro';
import VideoMobile from '@components/VideoMobile.astro';
import VideoFullScreen from '@components/VideoFullScreen.astro';
---

<section id="video-section" class="page__section dark">
	<VideoFullScreen />
	<div class="video__container">
		<div class="section video__mobile__container">
			<VideoMobile classes="video__mobile" />
		</div>

		<div class="video__desktop__container">
			<VideoDesktop />
		</div>
		<div class="big">
			<Image src={big} width={1966} height={453} alt="Just a decorative pattern" />
		</div>
	</div>
</section>

<style>
	#video-section {
		max-width: 1920px;
		margin: 0 auto;
	}
	.video__container {
		position: relative;
		z-index: 10;
	}
	.video__desktop__container {
		position: relative;
		z-index: 20;
		margin-inline: auto;
		max-width: 1440px;
	}
	.big {
		position: absolute;
		pointer-events: none;
		z-index: 1;
		top: 0;
		right: 0;
		transform: translate(50%, -25%);
		width: 100%;
		max-width: 548px;
	}
	@media (min-width: 1024px) {
		.section.video__mobile__container {
			display: none;
		}
		.video__desktop {
			display: block;
		}
		.big {
			transform: translate(25%, -25%);
		}
	}
</style>

<script>
	import gsap from 'gsap';
	import ScrollTrigger from 'gsap/ScrollTrigger';
	gsap.registerPlugin(ScrollTrigger);

	document.addEventListener('DOMContentLoaded', () => {
		gsap
			.timeline({
				scrollTrigger: {
					trigger: '#video-section .big',
					start: 'top bottom',
					end: 'bottom 10%',
					scrub: true,
				},
			})
			.to('#video-section .big img', {
				rotate: -18,
			});

		gsap
			.timeline({
				scrollTrigger: {
					trigger: '#video-section',
					start: 'top bottom',
					end: 'bottom bottom',
					scrub: true,
				},
			})
			.fromTo(
				'.video__desktop__container',
				{
					clipPath: 'polygon(25% 25%, 75% 25%, 75% 75%, 25% 75%)',
				},
				{
					clipPath: 'polygon(0% 0%, 100% 0%, 100% 100%, 0% 100%)',
				}
			);
	});
</script>
